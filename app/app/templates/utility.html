{% extends "appbuilder/base.html" %}

{% block content %}	
	{% include "confirm_msg.html" %}

	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.2/css/bootstrap-select.min.css">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.2/js/bootstrap-select.min.js"></script>

    <div class="container">
		<form method="post">
			<h4>Utility functions</h4>
			<div>
				<button type="button" class="btn btn-primary" onclick="empty_db()">Empty the db</button>
			</div>
			<br>
			<h4>Empty the db and load the test data</h4>
			<div>
				<button type="button" class="btn btn-primary" onclick="init_db()">Empty and load data</button>
			</div>
			<br>
			<h4>Upload data from the student career management procedure (Esse3)</h4>
			<div>
				<button type="button" class="btn btn-primary" onclick="load_academic_years()">
					Load the academic years for which there is a training offer in the database
				</button>
				<br><br>
				<select name="academicYears" id="academicYears">
					{% for a in academicYears %}
						<option value={{a}}>{{a}}</option>
					{% endfor %}
				</select>
			</div>
			<br>
			<div>
				<button type="button" class="btn btn-primary" onclick="load_educational_offer($('#academicYears').val())">
					Load the educational offer for the selected year
				</button>
				<br><br>
				<select class="selectpicker" multiple data-live-search="true">
					{% for e in educationalOffer %}
						<option value={{e["courseId"]}}>{{e["courseCod"]}} - {{e["courseDes"]}}</option>
					{% endfor %}
				</select>
			</div>
		</form>
	</div>
	
	<script>	
	function init_db() {
		$('#title').html('Richiesta di conferma');
		$('#msg').html('Si intende realmente inizializzare il database con i dati di test?');
		$(document).on("click", "#modal-confirm-ok", function () {
			window.location.href="{{ url_for('UtilitaView.srv_util', target='initdb')}}";
        });
		$('#modal-confirm-w').modal('show');
	}	
	
	function empty_db() {
		$('#title').html('Richiesta di conferma');
		$('#msg').html('Si intende realmente svuotare il database?');
		$(document).on("click", "#modal-confirm-ok", function () {
			window.location.href="{{ url_for('UtilitaView.srv_util', target='emptydb')}}";
        });
		$('#modal-confirm-w').modal('show');
	}

	function load_academic_years() {
		window.location.href="{{ url_for('UtilitaView.srv_util', target='load_academic_years')}}";
	}

	function load_educational_offer(ay) {
		window.location.href="{{ url_for('UtilitaView.srv_util', target='load_educational_offer?academicYear=2020') | replace('%3F', '?') | replace('%3D', '=')}}";
	}
	</script>
	
{% endblock %}

